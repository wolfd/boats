(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     36928,        901]
NotebookOptionsPosition[     36687,        888]
NotebookOutlinePosition[     37027,        903]
CellTagsIndexPosition[     36984,        900]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<BoatContext`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"DEBUG", " ", "THING"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "debug", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"debug", ",", "HoldAll"}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"debug", "[", "code_", "]"}], ":=", 
   RowBox[{"Internal`InheritedBlock", "[", 
    RowBox[{
     RowBox[{"{", "Message", "}"}], ",", 
     RowBox[{
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "inMessage", "}"}], ",", 
        RowBox[{
         RowBox[{"Unprotect", "[", "Message", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Message", "[", "args___", "]"}], "/;", 
           RowBox[{"!", 
            RowBox[{"MatchQ", "[", 
             RowBox[{
              RowBox[{"First", "[", 
               RowBox[{"Hold", "[", "args", "]"}], "]"}], ",", "_$Off"}], 
             "]"}]}]}], ":=", 
          RowBox[{
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"inMessage", "=", "True"}], "}"}], ",", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Shallow", "/@", 
                    RowBox[{"Replace", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"HoldForm", "[", 
                    RowBox[{"f_", "[", "___", "]"}], "]"}], "\[RuleDelayed]", 
                    
                    RowBox[{"HoldForm", "[", "f", "]"}]}], ",", "1"}], 
                    "]"}]}], ",", 
                   RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Map", "[", 
                    RowBox[{"Short", ",", 
                    RowBox[{"Last", "[", "#", "]"}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}], ",", "Red"}], "]"}]}], 
                  "}"}], "&"}], "@", 
                RowBox[{"Drop", "[", 
                 RowBox[{
                  RowBox[{"Drop", "[", 
                   RowBox[{
                    RowBox[{"Stack", "[", "_", "]"}], ",", 
                    RowBox[{"-", "7"}]}], "]"}], ",", "4"}], "]"}]}], "]"}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"Message", "[", "args", "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Throw", "[", 
               RowBox[{"$Failed", ",", "Message"}], "]"}], ";"}]}], "]"}], "/;", 
           RowBox[{"!", 
            RowBox[{"TrueQ", "[", "inMessage", "]"}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Protect", "[", "Message", "]"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Catch", "[", 
       RowBox[{
        RowBox[{"StackComplete", "[", "code", "]"}], ",", "Message"}], 
       "]"}]}]}], "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Standard", " ", "Boat", " ", "Library"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Needs", "[", "\"\<CUDALink`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Generate", " ", "point", " ", "cloud", " ", "from", " ", 
    "BoundaryMeshRegion"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"pointCloud", "[", 
     RowBox[{
      RowBox[{"reg_", "?", "RegionQ"}], ",", "numPoints_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"RandomPoint", "[", 
     RowBox[{"reg", ",", "numPoints"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "sortPoints", "]"}], ";"}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"sortPoints", "[", 
     RowBox[{"pts_", ",", "normal_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"sortPoints", "[", 
      RowBox[{"pts", ",", "normal"}], "]"}], "=", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"False", ",", "\[IndentingNewLine]", 
       RowBox[{"CUDASort", "[", 
        RowBox[{"CUDADot", "[", 
         RowBox[{"pts", ",", 
          RowBox[{"N", "[", "normal", "]"}]}], "]"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Sort", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", ".", "normal"}], "&"}], "/@", "pts"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "waterLineOld", "]"}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Returns", " ", "the", " ", "index", " ", "that", " ", "puts", " ", "a", 
    " ", "certain", " ", "portion", " ", "of", " ", "the", " ", "volume", " ",
     "underwater"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"waterLineOld", "[", 
     RowBox[{
     "pts_", ",", "normal_", ",", "meshVolume_", ",", "volumeUnderwater_"}], 
     "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"waterLineOld", "[", 
      RowBox[{
      "pts", ",", "normal", ",", "meshVolume", ",", "volumeUnderwater"}], 
      "]"}], "=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"numPoints", ",", "dists"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"numPoints", "=", 
         RowBox[{
          RowBox[{"volumeUnderwater", "/", "meshVolume"}], " ", "*", " ", 
          RowBox[{"Length", "[", "pts", "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dists", "=", 
         RowBox[{"sortPoints", "[", 
          RowBox[{"pts", ",", "normal"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Possible", " ", 
          RowBox[{"improvement", ":", " ", 
           RowBox[{
           "linear", " ", "interpolate", " ", "between", " ", "values", " ", 
            "at", " ", "two", " ", "points"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"dists", "[", 
         RowBox[{"[", 
          RowBox[{"Floor", "[", "numPoints", "]"}], "]"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "waterLine", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"waterLine", "[", 
     RowBox[{"boat_", ",", "normal_", ",", "desiredVolumeUnderwater_"}], 
     "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "bouys", ",", "bouy", ",", "bPoints", ",", "fullySubmergedVolume", ",",
         "indexOfWaterLine", ",", "pointDistances"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bouys", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"boat", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "type", "]"}], "\[Equal]", "\"\<Bouy\>\""}], 
           "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "Only", " ", "one", " ", "bouy", " ", "object", " ", "per", " ", 
          "boat", " ", "is", " ", "allowed"}], ",", " ", 
         RowBox[{
         "due", " ", "to", " ", "different", " ", "point", " ", "masses"}]}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "bouys", "]"}], "\[NotEqual]", "1"}], ",", 
         RowBox[{
         "Throw", "[", "\"\<No don't do that, one bouy per boat please\>\"", 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"bouy", "=", 
        RowBox[{"bouys", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "These", " ", "operations", " ", "are", " ", "for", " ", "many", " ",
           "bouys"}], ",", " ", 
         RowBox[{
         "but", " ", "only", " ", "one", " ", "bouy", " ", "is", " ", 
          "valid"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"fullySubmergedVolume", "=", 
        RowBox[{"volume", "/.", "bouy"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"bPoints", "=", 
        RowBox[{"points", "/.", "bouy"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Find", " ", "how", " ", "many", " ", "points", " ", "are", " ", 
         "underwater"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"indexOfWaterLine", "=", 
        RowBox[{
         RowBox[{"desiredVolumeUnderwater", "/", "fullySubmergedVolume"}], 
         "*", 
         RowBox[{"Length", "[", "bPoints", "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Index", " ", "must", " ", "be", " ", "in", " ", "range", " ", "of", 
         " ", "points"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"indexOfWaterLine", "<", "1"}], ",", 
         RowBox[{"Throw", "[", "\"\<Index not >= 1\>\"", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"indexOfWaterLine", ">", 
          RowBox[{"Length", "[", "bPoints", "]"}]}], ",", 
         RowBox[{"Throw", "[", "\"\<Index > number of points\>\"", "]"}]}], 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"pointDistances", "=", 
        RowBox[{"sortPoints", "[", 
         RowBox[{"bPoints", ",", "normal"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Possible", " ", 
         RowBox[{"improvement", ":", " ", 
          RowBox[{
          "linear", " ", "interpolate", " ", "between", " ", "values", " ", 
           "at", " ", "two", " ", "points"}]}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"pointDistances", "[", 
        RowBox[{"[", 
         RowBox[{"Floor", "[", "indexOfWaterLine", "]"}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "calculateVolumeUnderwater", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"calculateVolumeUnderwater", "[", "boat_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"calculateVolumeUnderwater", "[", "boat", "]"}], "=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"boatMass", ",", "displacedWaterVolume"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"boatMass", "=", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{"p", "[", "mass", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"p", ",", 
             RowBox[{"Select", "[", 
              RowBox[{"boat", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "[", "type", "]"}], "\[Equal]", 
                 "\"\<PointMass\>\""}], "&"}]}], "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"displacedWaterVolume", "=", 
         RowBox[{"boatMass", "/", "waterDensity"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "calculateWaterLine", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"calculateWaterLine", "[", 
    RowBox[{"boat_", ",", "wNormal_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"calculateWaterLine", "[", 
     RowBox[{"boat", ",", "wNormal"}], "]"}], "=", "\[IndentingNewLine]", 
    RowBox[{"waterLine", "[", 
     RowBox[{"boat", ",", "wNormal", ",", 
      RowBox[{"calculateVolumeUnderwater", "[", "boat", "]"}]}], "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"calculateForces", "[", 
     RowBox[{"boat_", ",", "wNormal_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "bouys", ",", "bouy", ",", "masses", ",", "weightForces", ",", 
        "bouyancyForce"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bouys", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"boat", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "type", "]"}], "\[Equal]", "\"\<Bouy\>\""}], 
           "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Assume", " ", "prior", " ", "exception", " ", "thrown", " ", "if", 
         " ", "not", " ", "1", " ", "element"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"bouy", "=", 
        RowBox[{"bouys", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"masses", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"boat", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "type", "]"}], "\[Equal]", 
            "\"\<PointMass\>\""}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Calculate", " ", "the", " ", "forces"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"bouyancyForce", "=", 
        RowBox[{
         RowBox[{"calculateVolumeUnderwater", "[", "boat", "]"}], "*", 
         "waterDensity", "*", "g", "*", "wNormal"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"weightForces", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "*", 
           RowBox[{"(", 
            RowBox[{"g", "*", 
             RowBox[{"-", "wNormal"}]}], ")"}]}], "&"}], "/@", 
         RowBox[{"(", 
          RowBox[{"mass", "/.", "masses"}], ")"}]}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"Tricky", " ", "replacement", " ", "bullshit"}], " ", "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"<|", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"wfs", "\[Rule]", " ", "weightForces"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"bf", "\[Rule]", "bouyancyForce"}]}], "\[IndentingNewLine]", 
        "|>"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Find", " ", "the", " ", "points", " ", "of", " ", "the", " ", "bouyHull", 
    " ", "of", " ", "a", " ", "boat", " ", "when", " ", "translational", " ", 
    "forces", " ", "are", " ", "at", " ", "equib"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"pointsBelowWaterLine", "[", 
     RowBox[{"boat_", ",", "wNormal_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"bouy", ",", "waterHeight"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bouy", "=", 
        RowBox[{
         RowBox[{"Select", "[", 
          RowBox[{"boat", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", "type", "]"}], "\[Equal]", "\"\<Bouy\>\""}], 
            "&"}]}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"waterHeight", "=", 
        RowBox[{"calculateWaterLine", "[", 
         RowBox[{"boat", ",", "wNormal"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Dot", " ", "products"}], ",", " ", 
         RowBox[{
         "get", " ", "all", " ", "points", " ", "that", " ", "are", " ", 
          "below", " ", "the", " ", "water", " ", "height"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"pointsBelowWater", "=", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"points", "/.", "bouy"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", ".", "wNormal"}], "<=", "waterHeight"}], "&"}]}], 
         "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"calculateCOM", "[", "boat_", "]"}], ":=", "\[IndentingNewLine]", 
    
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"masses", ",", "coms", ",", "ms"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"masses", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"boat", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "type", "]"}], "\[Equal]", 
            "\"\<PointMass\>\""}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"coms", "=", 
        RowBox[{"com", "/.", "masses"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ms", "=", 
        RowBox[{"mass", "/.", "masses"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Plus", "@@", 
          RowBox[{"(", 
           RowBox[{"coms", "*", "ms"}], ")"}]}], ")"}], "/", 
        "\[IndentingNewLine]", 
        RowBox[{"Plus", "@@", "ms"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Find", " ", "the", " ", "COB", " ", "of", " ", "a", " ", "boat", " ", 
    "when", " ", "translational", " ", "forces", " ", "are", " ", "at", " ", 
    "equib"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"calculateCOB", "[", 
     RowBox[{"boat_", ",", "wNormal_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "points", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"points", "=", 
        RowBox[{"pointsBelowWaterLine", "[", 
         RowBox[{"boat", ",", "wNormal"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Quantity", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Sum", "[", 
           RowBox[{"p", ",", 
            RowBox[{"{", 
             RowBox[{"p", ",", "points"}], "}"}]}], "]"}], "/", 
          RowBox[{"Length", "[", "points", "]"}]}], ",", 
         "\"\<Centimeters\>\""}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"calculateMoments", "[", 
     RowBox[{"boat_", ",", "wNormal_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "bouys", ",", "bouy", ",", "masses", ",", "forces", ",", "bouyancy", 
        ",", "weights", ",", "bouyR", ",", "bouyMoment", ",", "weightsR", ",",
         "weightsMoments"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bouys", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"boat", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "type", "]"}], "\[Equal]", "\"\<Bouy\>\""}], 
           "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Assume", " ", "prior", " ", "exception", " ", "thrown", " ", "if", 
         " ", "not", " ", "1", " ", "element"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"bouy", "=", 
        RowBox[{"bouys", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"masses", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"boat", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "type", "]"}], "\[Equal]", 
            "\"\<PointMass\>\""}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Calculate", " ", "the", " ", "forces"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"forces", "=", 
        RowBox[{"calculateForces", "[", 
         RowBox[{"boat", ",", "wNormal"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"weights", "=", 
        RowBox[{"wfs", "/.", "forces"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"bouyancy", "=", 
        RowBox[{"bf", "/.", "forces"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Bouyancy", " ", "moment"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"bouyR", "=", 
        RowBox[{"calculateCOB", "[", 
         RowBox[{"boat", ",", "wNormal"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"bouyMoment", "=", 
        RowBox[{"Cross", "[", 
         RowBox[{"bouyR", ",", "bouyancy"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Calculate", " ", "weights", " ", "moments"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"weightsR", "=", 
        RowBox[{"com", "/.", "masses"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"weightsMoments", "=", 
        RowBox[{"Cross", "@@@", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"weightsR", ",", "weights"}], "}"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Return", " ", "the", " ", "moments"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Prepend", "[", 
        RowBox[{"weightsMoments", ",", "bouyMoment"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"plotAVSMoments", "[", 
     RowBox[{"boat_", ",", "samplePoints_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"moments", ",", "momentInterp", ",", 
        RowBox[{"maxAngle", "=", 
         RowBox[{"Pi", "/", "2"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Parallelize", " ", "the", " ", "creation", " ", "of", " ", 
        "moments"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"moments", "=", 
        RowBox[{"Parallelize", "[", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"calculateMoments", "[", 
            RowBox[{"boat", ",", 
             RowBox[{"Normalize", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Cos", "[", "\[Theta]", "]"}], ",", "0", ",", 
                RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "}"}], "]"}]}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"\[Theta]", ",", "0", ",", "maxAngle", ",", 
             RowBox[{"maxAngle", "/", "samplePoints"}]}], "}"}]}], 
          "\[IndentingNewLine]", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"momentInterp", "=", 
        RowBox[{"ListInterpolation", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Norm", "[", 
             RowBox[{"Plus", "@@", 
              RowBox[{"moments", "[", 
               RowBox[{"[", "n", "]"}], "]"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"n", ",", 
              RowBox[{"Length", "[", "moments", "]"}]}], "}"}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"0", ",", "maxAngle"}], "}"}]}], "\[IndentingNewLine]", 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"UnitConvert", "[", 
          RowBox[{
           RowBox[{"momentInterp", "[", "\[Theta]", "]"}], ",", 
           "\"\<NewtonMeters\>\""}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"\[Theta]", ",", "0", ",", "maxAngle"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"AxesLabel", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", "Label"}], "\[IndentingNewLine]", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Converts", " ", "things", " ", "into", " ", "a", " ", "dimension", " ", 
    "for", " ", "rendering", " ", 
    RowBox[{"(", 
     RowBox[{"based", " ", "on", " ", "STL", " ", "dimension"}], ")"}]}], " ",
    "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"convertUnitsForRender", "[", "quant_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"UnitDimensions", "[", "quant", "]"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"renderBoat", "[", 
     RowBox[{"boat_", ",", "wNormal_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "wl", ",", "waterPlane", ",", "pointMassParts", ",", "bouyParts", ",", 
        "cob"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Calculate", " ", "waterline", " ", "to", " ", "plot", " ", "plane", 
        " ", "on"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"wl", "=", 
        RowBox[{"calculateWaterLine", "[", 
         RowBox[{"boat", ",", "wNormal"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"waterPlane", "=", 
        RowBox[{"{", 
         RowBox[{"Blue", ",", 
          RowBox[{"Opacity", "[", "0.2", "]"}], ",", 
          RowBox[{"HalfSpace", "[", 
           RowBox[{"wNormal", ",", 
            RowBox[{"wNormal", "*", "wl"}]}], "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Grab", " ", "all", " ", "point", " ", "masses", " ", "to", " ", 
         "render"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pointMassParts", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"boat", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "type", "]"}], "\[Equal]", 
            "\"\<PointMass\>\""}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Render", " ", "bouy"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"bouyParts", "=", 
        RowBox[{
         RowBox[{"Select", "[", 
          RowBox[{"boat", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", "type", "]"}], "\[Equal]", "\"\<Bouy\>\""}], 
            "&"}]}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"cob", "=", 
        RowBox[{"QuantityMagnitude", "[", 
         RowBox[{"calculateCOB", "[", 
          RowBox[{"boat", ",", "wNormal"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{"{", 
         RowBox[{"waterPlane", ",", 
          RowBox[{"render", "/.", "pointMassParts"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"cobRender", "/.", "bouyParts"}], ")"}], "@", "cob"}]}], 
         "}"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"renderBoatWithForces", "[", 
     RowBox[{"boat_", ",", "wNormal_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "front", ",", "forces", ",", "wForces", ",", "bForce", ",", 
        "momentSum", ",", "com", ",", "scale", ",", "arrow", ",", "text", ",",
         "wVecs", ",", "bVec", ",", "mVecs", ",", "mText"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"front", "=", 
        RowBox[{"front", "/.", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"boat", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "type", "]"}], "\[Equal]", "\"\<Bouy\>\""}], 
             "&"}]}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"forces", "=", 
        RowBox[{"UnitConvert", "[", 
         RowBox[{
          RowBox[{"calculateForces", "[", 
           RowBox[{"boat", ",", "wNormal"}], "]"}], ",", "\"\<Newtons\>\""}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"wForces", "=", 
        RowBox[{"wfs", "/.", "forces"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"bForce", "=", 
        RowBox[{"bf", "/.", "forces"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"momentSum", "=", 
        RowBox[{"UnitConvert", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Plus", "@@", 
           RowBox[{"calculateMoments", "[", 
            RowBox[{"boat", ",", "wNormal"}], "]"}]}], ",", 
          "\[IndentingNewLine]", "\"\<NewtonMeters\>\""}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"com", "=", 
        RowBox[{"QuantityMagnitude", "[", 
         RowBox[{"calculateCOM", "[", "boat", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"scale", "=", "0.5"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"arrow", "=", 
        RowBox[{
         RowBox[{"Line", "[", 
          RowBox[{"{", 
           RowBox[{"com", ",", 
            RowBox[{"com", "+", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"QuantityMagnitude", "[", "#", "]"}], "*", "scale"}], 
              ")"}]}]}], "}"}], "]"}], "&"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"text", "=", 
        RowBox[{
         RowBox[{"Text", "[", 
          RowBox[{"#", ",", 
           RowBox[{"com", "+", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"QuantityMagnitude", "[", "#", "]"}], "*", "scale"}], 
             ")"}]}]}], "]"}], "&"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"wVecs", "=", 
        RowBox[{"{", 
         RowBox[{"Red", ",", 
          RowBox[{"arrow", "/@", "wForces"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"bVec", "=", 
        RowBox[{"{", 
         RowBox[{"Blue", ",", 
          RowBox[{"arrow", "@", "bForce"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Arbitrary", " ", "numbers", " ", "to", " ", "scale"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"mVecs", "=", 
        RowBox[{"{", 
         RowBox[{"Purple", ",", 
          RowBox[{"arrow", "@", 
           RowBox[{"(", 
            RowBox[{"momentSum", "*", "20"}], ")"}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"mText", "=", 
        RowBox[{"{", 
         RowBox[{"text", "@", "momentSum"}], "}"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"renderBoat", "[", 
          RowBox[{"boat", ",", "wNormal"}], "]"}], ",", 
         RowBox[{"Graphics3D", "[", 
          RowBox[{"{", 
           RowBox[{"wVecs", ",", "bVec", ",", "mVecs"}], "}"}], "]"}]}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.664718584499712*^9, 3.664718605892984*^9}, {
   3.664718898933992*^9, 3.66471890787156*^9}, {3.66471904222403*^9, 
   3.664719044274046*^9}, {3.664719160401458*^9, 3.664719201359337*^9}, {
   3.664719237346527*^9, 3.6647192540158587`*^9}, {3.664719356219804*^9, 
   3.6647193636186*^9}, {3.6647194033463078`*^9, 3.6647194116147013`*^9}, {
   3.6647194417919416`*^9, 3.664719445959969*^9}, {3.6647194908773108`*^9, 
   3.6647194925131283`*^9}, {3.6647195236799*^9, 3.664719534588866*^9}, {
   3.664719578767035*^9, 3.664719590635721*^9}, {3.664719710718672*^9, 
   3.6647198114011602`*^9}, {3.66471990605333*^9, 3.66472003791329*^9}, {
   3.6647203360703573`*^9, 3.664720346553726*^9}, {3.66472042243576*^9, 
   3.664720545301304*^9}, 3.664720583351769*^9, {3.664720721819213*^9, 
   3.664720729553821*^9}, {3.6647216789246798`*^9, 3.6647216789771423`*^9}, 
   3.664722632121976*^9, {3.664728639469472*^9, 3.664728686864766*^9}, {
   3.6647287284000683`*^9, 3.664728895812759*^9}, {3.664728938161757*^9, 
   3.664729034836721*^9}, {3.6647290650004663`*^9, 3.6647291704673357`*^9}, {
   3.6647293785488033`*^9, 3.6647293790006933`*^9}, {3.6647294446463118`*^9, 
   3.6647294615839233`*^9}, {3.6647294919800367`*^9, 3.664729495959642*^9}, {
   3.664729980070524*^9, 3.6647299947700653`*^9}, {3.664730188674028*^9, 
   3.664730194330639*^9}, {3.664730534159028*^9, 3.664730537886018*^9}, {
   3.664733813426251*^9, 3.6647338150080843`*^9}, {3.664734746083345*^9, 
   3.664734753373899*^9}, {3.664735800424076*^9, 3.664735802222994*^9}, {
   3.664775966778352*^9, 3.664775967788842*^9}, {3.664780011845285*^9, 
   3.664780036894313*^9}, {3.664780073477683*^9, 3.664780129768664*^9}, {
   3.6647801722675047`*^9, 3.6647801895932426`*^9}, {3.664780252766951*^9, 
   3.66478030953165*^9}, {3.664780395408352*^9, 3.664780557557609*^9}, {
   3.664780642989401*^9, 3.664780644781433*^9}, {3.6647826754107103`*^9, 
   3.664782770850759*^9}, {3.664782820788473*^9, 3.6647828747201157`*^9}, {
   3.6647830909587*^9, 3.664783127122506*^9}, {3.66478316557395*^9, 
   3.664783173958743*^9}, {3.664783221440226*^9, 3.6647832474223757`*^9}, {
   3.664783313293483*^9, 3.664783340238469*^9}, {3.664783390440246*^9, 
   3.664783535142433*^9}, {3.664783571431652*^9, 3.664783668386104*^9}, {
   3.664783785023074*^9, 3.664783796483672*^9}, {3.664784637963685*^9, 
   3.664784679619235*^9}, {3.664784729404668*^9, 3.6647849250703917`*^9}, {
   3.664784958913953*^9, 3.664784972032477*^9}, {3.664785016820459*^9, 
   3.664785091798747*^9}, {3.664785129791683*^9, 3.664785182406456*^9}, 
   3.664785227312505*^9, {3.664785482219411*^9, 3.6647855019967937`*^9}, {
   3.664785568252643*^9, 3.6647856770066757`*^9}, {3.664785849663417*^9, 
   3.664785854456161*^9}, {3.6647859108706083`*^9, 3.664785920638358*^9}, {
   3.664785972914122*^9, 3.664785973108322*^9}, {3.6647860432739563`*^9, 
   3.6647860466972523`*^9}, {3.6647860842950706`*^9, 3.664786123422208*^9}, {
   3.6647861591329727`*^9, 3.664786251161072*^9}, {3.664786778171214*^9, 
   3.664786827336316*^9}, {3.66478699433258*^9, 3.664787033103826*^9}, {
   3.664787183754189*^9, 3.664787204688765*^9}, {3.664787304942151*^9, 
   3.664787309618553*^9}, {3.6647878330402327`*^9, 3.664787844515832*^9}, {
   3.664788023809993*^9, 3.664788044712063*^9}, {3.664788096524263*^9, 
   3.664788100384004*^9}, {3.6647886346816263`*^9, 3.664788749365718*^9}, {
   3.664788787650916*^9, 3.664788860376546*^9}, {3.664788907284132*^9, 
   3.664789021945863*^9}, {3.664789067586916*^9, 3.664789089982003*^9}, {
   3.66478915304025*^9, 3.6647891783087473`*^9}, {3.664789233162839*^9, 
   3.664789260430119*^9}, {3.6647893229899797`*^9, 3.664789335629327*^9}, {
   3.664789448123702*^9, 3.66478945561836*^9}, {3.66479047578751*^9, 
   3.66479049469794*^9}, {3.6647927372034473`*^9, 3.664792741010706*^9}, {
   3.66479347547055*^9, 3.6647936031925697`*^9}, {3.6647954083517838`*^9, 
   3.6647954087983522`*^9}}]
},
WindowSize->{956, 1016},
WindowMargins->{{Automatic, -10}, {Automatic, -8}},
FrontEndVersion->"10.3 for Linux x86 (64-bit) (December 10, 2015)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 36125, 866, 5661, "Input"]
}
]
*)

(* End of internal cache information *)
